<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>bitmoji-lab</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="app">
    <div class="rows-container">

      <!-- ================= HEADER ================= -->
      <div class="header">
        <div class="bismillah" aria-hidden="true">
          Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù
        </div>

        <div class="title-block">
          <img src="logo.svg" alt="Logo" class="site-logo animated-logo" />
          <div>
            <h1>bitmoji-lab</h1>
            <div class="subtitle">explore - create - innovate</div>
          </div>
        </div>

        <div class="status-pill" id="statusPill">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">Disconnected</span>
        </div>
      </div>

      <!-- ================= EMOJI CARD (TOP, REORGANIZED) ================= -->
      <div class="card" id="emojiCard">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">ğŸ˜„</span> Emoji
            </div>
            <div class="card-subtitle">
              Pick an emoji â†’ we convert it to a 16Ã—16 bitmap â†’ send it to the micro:bit
            </div>
          </div>
        </div>

        <div class="control-section">
          <div class="emoji-reorganized">
            <!-- LEFT: Emoji picker and Selected -->
            <div class="emoji-left">
              <div class="section-header">
                <div class="section-title">
                  <span class="section-icon">ğŸ§©</span> Emoji library
                </div>
                <div class="section-subtitle">Click one to preview</div>
              </div>
              <div id="emojiList" class="emoji-grid" aria-label="Emoji list"></div>
              
              <div class="emoji-selected">
                <div class="emoji-selected-label">Selected</div>
                <div class="emoji-selected-value" id="selectedEmojiText">â€”</div>
                <div class="emoji-selected-description" id="selectedEmojiDescription" style="font-size: 0.7rem; color: #9ca3af; margin-top: 4px; text-align: center; min-height: 20px;">
                  Click an emoji to see description
                </div>
                
                <!-- Matrix Size Selector -->
                <div style="margin: 12px 0;">
                  <label for="matrixSize" style="display: block; font-size: 0.75rem; color: #9ca3af; margin-bottom: 6px;">
                    ğŸ“ Matrix Size
                  </label>
                  <select id="matrixSize" style="width: 100%; padding: 6px; background: rgba(15,23,42,0.6); color: #e5e7eb; border: 1px solid rgba(148,163,184,0.3); border-radius: 6px; cursor: pointer;">
                    <option value="16">16Ã—16 (256 LEDs)</option>
                    <option value="8">8Ã—8 (64 LEDs)</option>
                  </select>
                </div>
                
                <!-- Brightness Control -->
                <div style="margin: 12px 0;">
                  <label for="brightnessSlider" style="display: block; font-size: 0.75rem; color: #9ca3af; margin-bottom: 6px;">
                    ğŸ’¡ Brightness: <span id="brightnessValue">80</span>%
                  </label>
                  <input type="range" id="brightnessSlider" min="10" max="255" value="80" 
                         style="width: 100%; height: 6px; accent-color: #22c55e;">
                </div>
                
                

                <!-- Brush Color - FUN FOR KIDS! -->
                <div style="margin: 12px 0; padding: 12px; background: linear-gradient(135deg, rgba(255,0,255,0.1), rgba(0,255,255,0.1)); border-radius: 12px; border: 2px dashed rgba(148,163,184,0.4);">
                  <label for="brushColor" style="display: block; font-size: 0.85rem; color: #fbbf24; margin-bottom: 8px; font-weight: 700; text-align: center; text-shadow: 0 0 10px rgba(251,191,36,0.5);">
                    ğŸ–Œï¸âœ¨ MAGIC PAINTBRUSH âœ¨ğŸ¨
                  </label>
                  
                  <!-- Rainbow Color Buttons -->
                  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 10px;">
                    <button class="color-btn" data-color="#ff0000" style="background: linear-gradient(135deg, #ff0000, #ff6b6b); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Red">
                      ğŸ“
                    </button>
                    <button class="color-btn" data-color="#ffa500" style="background: linear-gradient(135deg, #ffa500, #ffdd57); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Orange">
                      ğŸ¦Š
                    </button>
                    <button class="color-btn" data-color="#ffff00" style="background: linear-gradient(135deg, #ffff00, #fff89a); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Yellow">
                      â­
                    </button>
                    <button class="color-btn" data-color="#00ff00" style="background: linear-gradient(135deg, #00ff00, #7aff7a); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Green">
                      ğŸ¦–
                    </button>
                    <button class="color-btn" data-color="#0080ff" style="background: linear-gradient(135deg, #0080ff, #66b3ff); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Blue">
                      ğŸš€
                    </button>
                    <button class="color-btn" data-color="#a020f0" style="background: linear-gradient(135deg, #a020f0, #d17aff); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Purple">
                      ğŸ¦„
                    </button>
                    <button class="color-btn" data-color="#ff1493" style="background: linear-gradient(135deg, #ff1493, #ff69b4); height: 36px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; transition: transform 0.2s;" title="Pink">
                      ğŸ¦©
                    </button>
                    <button class="color-btn" data-color="#ffffff" style="background: linear-gradient(135deg, #ffffff, #f0f0f0); height: 36px; border-radius: 8px; border: 2px solid rgba(148,163,184,0.5); cursor: pointer; transition: transform 0.2s;" title="White">
                      â˜ï¸
                    </button>
                  </div>
                  
                  <!-- Custom Color Picker -->
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <label for="brushColor" style="font-size: 0.7rem; color: #e5e7eb;">
                      ğŸŒˆ Or pick your own:
                    </label>
                    <input type="color" id="brushColor" value="#ff0000"
                           style="flex: 1; height: 32px; padding: 0; border: 2px solid rgba(148,163,184,0.4); border-radius: 8px; background: rgba(15,23,42,0.6); cursor: pointer;" />
                  </div>
                  
                  <div class="hint" style="margin-top:8px; text-align: center; font-size: 0.7rem; color: #a5f3fc;">
                    ğŸ–±ï¸ Click + drag to paint â€¢ Hold Shift to erase âœ¨
                  </div>
                </div>
                <button id="sendEmojiBtn" class="primary" disabled>
                  <span class="btn-icon">ğŸ“¤</span>Send emoji to micro:bit
                </button>
                <div class="hint" style="margin-top:10px;">
                  <div class="hint-title">Serial payload</div>
                  <div class="hint-text">
                    We send <code>RGBMOJI:&lt;1536-hex&gt;</code> (256 pixels Ã— RGB = 768 bytes) - now with deduplication!
                  </div>
                </div>
              </div>
            </div>

            <!-- RIGHT: Preview -->
            <div class="emoji-right">
              <div class="emoji-matrix-wrap">
                <div class="emoji-matrix-title">16Ã—16 preview</div>
                <div id="emojiMatrix" class="pixel-matrix editable" aria-label="16 by 16 dot preview"></div>
                
                <!-- Preview Controls -->
                <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; justify-content: center;">
                  <button id="clearPreviewBtn" class="secondary" style="font-size: 0.75rem; padding: 6px 12px;">
                    ğŸ—‘ï¸ Clear
                  </button>
                  <button id="testRedBtn" class="secondary" style="font-size: 0.75rem; padding: 6px 12px; background: rgba(239, 68, 68, 0.2);">
                    ğŸ”´ Red
                  </button>
                  <button id="testGreenBtn" class="secondary" style="font-size: 0.75rem; padding: 6px 12px; background: rgba(34, 197, 94, 0.2);">
                    ğŸŸ¢ Green
                  </button>
                  <button id="testBlueBtn" class="secondary" style="font-size: 0.75rem; padding: 6px 12px; background: rgba(59, 130, 246, 0.2);">
                    ğŸ”µ Blue
                  </button>
                  <button id="testWhiteBtn" class="secondary" style="font-size: 0.75rem; padding: 6px 12px; background: rgba(255, 255, 255, 0.2);">
                    âšª White
                  </button>
                </div>
                
                <!-- ğŸ’¾ SAVE CURRENT DESIGN -->
                <div style="margin-top: 16px; padding: 12px; background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(59,130,246,0.1)); border-radius: 12px; border: 2px dashed rgba(148,163,184,0.4);">
                  <div style="font-size: 0.8rem; color: #fbbf24; margin-bottom: 8px; font-weight: 700; text-align: center; text-shadow: 0 0 10px rgba(251,191,36,0.5);">
                    ğŸ’¾âœ¨ SAVE YOUR ART âœ¨ğŸ’¾
                  </div>
                  <div style="display: flex; gap: 6px;">
                    <input type="text" id="saveNameInput" placeholder="Give it a cool name! ğŸ¨" 
                           style="flex: 1; padding: 8px; background: rgba(15,23,42,0.8); color: #e5e7eb; border: 1px solid rgba(148,163,184,0.4); border-radius: 8px; font-size: 0.75rem;">
                    <button id="saveDesignBtn" class="primary" style="font-size: 0.75rem; padding: 8px 16px; white-space: nowrap;">
                      ğŸ’¾ Save
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ================= COLLAPSIBLE: SAVED DESIGNS ================= -->
      <details class="collapsible" open>
        <summary>
          <span class="icon">ğŸ“š</span> My Saved Designs
        </summary>
        <div class="card" id="savedDesignsCard">
          <div class="card-subtitle" style="margin-bottom: 12px; text-align: center;">
            Your awesome emoji creations! ğŸ¨âœ¨
          </div>

          <div id="savedDesignsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
            <!-- Saved designs will appear here -->
          </div>
          
          <div id="noSavedDesigns" class="hint" style="text-align: center; padding: 20px; display: none;">
            No saved designs yet! ğŸ¨<br>
            Create something awesome and save it above! âœ¨
          </div>
        </div>
      </details>

      <!-- ================= COLLAPSIBLE: DEMOS ================= -->
      <details class="collapsible" open>
        <summary>
          <span class="icon">ğŸ¬</span> Demos & Animations
        </summary>
        <div class="card" id="demoCard">
          <div class="card-subtitle" style="margin-bottom: 12px; text-align: center;">
            Watch cool animations and see what's possible! ğŸŒŸ
          </div>

          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
            <!-- Row 1 -->
            <button id="demoWavingFlag" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸ´ Waving Flag
            </button>
            <button id="demoTrafficLight" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸš¦ Traffic Light
            </button>
            
            <!-- Row 2 -->
            <button id="demoHeartBeat" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸ’“ Heart Beat
            </button>
            <button id="demoSpinningStar" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              â­ Spinning Star
            </button>
            
            <!-- Row 3 -->
            <button id="demoRainbowWave" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸŒˆ Rainbow Wave
            </button>
            <button id="demoSmiley" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸ˜„ Happy Face
            </button>
            
            <!-- Row 4 -->
            <button id="demoLoadingBar" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              â³ Loading Bar
            </button>
            <button id="demoFireworks" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸ† Fireworks
            </button>
            
            <!-- Row 5 -->
            <button id="demoRacingCar" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸï¸ Racing Car
            </button>
            <button id="demoStopSign" class="secondary" style="font-size: 0.75rem; padding: 8px 12px;">
              ğŸ›‘ Stop Animation
            </button>
          </div>
          
          <button id="stopDemo" class="fire-btn" style="width: 100%; margin-top: 12px; font-size: 0.8rem; padding: 10px;">
            Stop Demo
          </button>
          
          <div class="hint" style="margin-top: 10px; text-align: center;">
            Click any demo to see it animate on the preview! ğŸ¬
          </div>
        </div>
      </details>

      <!-- ================= COLLAPSIBLE: CONNECTION ================= -->
      <details class="collapsible" open>
        <summary>
          <span class="icon">ğŸ”Œ</span> Connection
        </summary>
        <div class="card" id="connectionCard">
          <div class="card-subtitle" style="margin-bottom: 8px;">
            Connect to your micro:bit over USB Serial
          </div>

          <div class="button-row">
            <button id="connectBtn" class="primary">
              <span class="btn-icon">ğŸ”—</span>Connect
            </button>

            <button id="disconnectBtn" class="secondary" disabled>
              <span class="btn-icon">â›”</span>Disconnect
            </button>
          </div>

          <div class="hint">
            <div class="hint-title">Tip</div>
            <ol>
              <li>Use Chrome / Edge (desktop)</li>
              <li>Select the micro:bit serial port</li>
            </ol>
          </div>
        </div>
      </details>

      <!-- ================= COLLAPSIBLE: SEND MESSAGE ================= -->
      <details class="collapsible">
        <summary>
          <span class="icon">âœ‰ï¸</span> Send Message
        </summary>
        <div class="card" id="messageCard">
          <div class="card-subtitle" style="margin-bottom: 8px;">
            Type a short message or run the throughput test
          </div>

          <div class="control-section">
            <div class="section-header">
              <div class="section-title">
                <span class="section-icon">âŒ¨ï¸</span> Message
              </div>
              <div class="section-subtitle">
                Press Enter or click Send
              </div>
            </div>

            <div class="form-row">
              <input
                type="text"
                id="messageInput"
                placeholder="Type your message here..."
              />
              <button id="sendBtn" class="primary" disabled>
                <span class="btn-icon">ğŸ“¨</span>Send
              </button>
            </div>

            <!-- TEST BUTTON -->
            <div class="button-row" style="margin-top: 12px;">
              <button id="testBtn" class="secondary" disabled>
                <span class="btn-icon">ğŸ§ª</span>Test 0..1000
              </button>
              <button id="clearStatsBtn" class="secondary">
                <span class="btn-icon">ğŸ—‘ï¸</span>Clear Stats
              </button>
            </div>
          </div>
        </div>
      </details>

      <!-- ================= COLLAPSIBLE: LOG ================= -->
      <details class="collapsible" open>
        <summary>
          <span class="icon">ğŸ“œ</span> Communication Log
        </summary>
        <div class="card log-card" id="logCard">
          <div class="card-header">
            <div class="card-subtitle">
              TX = sent â€¢ RX = received
            </div>

            <!-- LOG CONTROLS -->
            <div class="log-controls">
              <button id="clearLogBtn" class="secondary small">
                <span class="btn-icon">ğŸ§¹</span>Clear
              </button>

              <button id="copyLogBtn" class="secondary small">
                <span class="btn-icon">ğŸ“‹</span>Copy
              </button>

              <button id="exportLogBtn" class="secondary small">
                <span class="btn-icon">â¬‡ï¸</span>Export
              </button>
            </div>
          </div>

          <div class="log" id="logContainer" aria-live="polite"></div>

          <div class="log-footer">
            <span>micro:bit Serial Logger</span>
            <span class="badge"><strong>USB</strong> serial</span>
          </div>
        </div>
      </details>

    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
